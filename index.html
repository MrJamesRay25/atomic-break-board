<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>The Atomic Break Board</title>
<link href="https://fonts.googleapis.com/css2?family=Monoton&family=Signika:wght@500;700&display=swap" rel="stylesheet">
<style>
  :root{ --bg:#0b1320; --panel:#0f2138; --mint:#9ff5d1; --neon:#f5e87a; --avail:#34f29a; --sold:#8aa0b2; }
  html,body{margin:0;height:100%;background:transparent;overflow:hidden;font-family:"Signika",system-ui,sans-serif;}
  .wrap{position:absolute;inset:0;display:flex;flex-direction:column;gap:10px;padding:16px 18px 12px;
        background:radial-gradient(1200px 600px at 12% 0%, #163355 0%, var(--bg) 60%);
        border:2px solid rgba(0,255,229,.18);border-radius:16px;box-shadow:0 12px 28px rgba(0,0,0,.45), inset 0 0 22px rgba(0,255,229,.08);}
  .header{font-family:"Monoton",cursive;font-size:40px;letter-spacing:2px;color:var(--neon);text-align:center;
          text-shadow:0 0 6px rgba(245,232,122,.9),0 0 18px rgba(245,232,122,.55),0 0 36px rgba(245,232,122,.35);}
  .counts{display:flex;gap:14px;justify-content:center;align-items:center;color:#cfe7ff;font-size:14px;}
  .badge{padding:6px 10px;border-radius:999px;border:1px solid rgba(159,245,209,.3);background:rgba(159,245,209,.08);}
  .badge .v{font-weight:700;color:var(--mint);margin-left:6px}
  .badge .g{color:var(--avail);margin-left:6px}
  .badge .r{color:#ff6b6b;margin-left:6px}
  .panel{position:relative;margin-top:6px;width:100%;flex:1 1 auto;background:linear-gradient(180deg,#0d1e33,var(--panel));
         border:2px solid rgba(159,245,209,.25);border-radius:16px;box-shadow:0 10px 26px rgba(0,0,0,.45), inset 0 0 18px rgba(159,245,209,.08);
         display:flex;flex-direction:column;overflow:hidden;}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(230px,1fr));gap:12px;padding:10px;overflow:auto;}
  .card{display:flex;align-items:center;gap:12px;padding:10px 14px;border-radius:14px;background:rgba(159,245,209,.07);
        border:1px solid rgba(159,245,209,.28);box-shadow:0 3px 12px rgba(0,0,0,.28), inset 0 0 12px rgba(159,245,209,.08);color:#cfe7ff;}
  .swatch{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;
          color:white;font-weight:800;letter-spacing:.5px;text-shadow:0 1px 2px rgba(0,0,0,.45);box-shadow:0 0 8px rgba(0,0,0,.35);}
  .name{font-weight:700;letter-spacing:.4px;color:var(--mint);}
  .card.sold{opacity:.6;filter:saturate(.25) grayscale(.3);border-color:rgba(138,160,178,.35);}
  .card.available .name{color:var(--avail);text-shadow:0 0 10px rgba(52,242,154,.4);}
  .card.sold .name{color:var(--sold);text-decoration:line-through;}
  .ticker-wrap{margin-top:auto;width:100%;border-top:1px solid rgba(0,255,229,.14);background:rgba(3,12,24,.35);}
  .ticker-mask{overflow:hidden;width:100%;}
  .ticker-track{display:flex;align-items:center;gap:20px;padding:8px 16px;white-space:nowrap;will-change:transform;}
  .ti{display:inline-flex;align-items:center;gap:10px;padding:6px 12px;border:1px solid rgba(159,245,209,.25);
      border-radius:999px;background:rgba(159,245,209,.08)}
  .ti.sold{opacity:.55;filter:saturate(.2)}
  .ti .tag{font-size:12px;padding:2px 8px;border-radius:999px;border:1px solid;}
  .ti .tag.av{color:var(--avail);border-color:rgba(52,242,154,.35);background:rgba(52,242,154,.15)}
  .ti .tag.sd{color:#ff6b6b;border-color:rgba(255,107,107,.35);background:rgba(255,107,107,.12)}
</style>
</head>
<body>
  <div class="wrap">
    <div class="header" id="header">The Atomic Break Board</div>
    <div class="counts">
      <div class="badge">Teams <span class="v" id="countTotal">0</span></div>
      <div class="badge">Available <span class="g" id="countAvail">0</span></div>
      <div class="badge">Sold <span class="r" id="countSold">0</span></div>
    </div>
    <div class="panel">
      <div class="grid" id="grid"></div>
      <div class="ticker-wrap">
        <div class="ticker-mask">
          <div class="ticker-track" id="ticker"></div>
        </div>
      </div>
    </div>
  </div>

<script>
// ===== CONFIG =====
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT2v6-URv5jiKt-jUeqhddeSqYAKE1Gr2405YGaZRvxeWFsRWMu2fAlN9j9mMz24Gp70dchwCnj7xec/pub?gid=0&single=true&output=csv";
const HEADER  = "The Atomic Break Board";
const REFRESH = 8;   // seconds
const SPEED   = 22;  // px/sec for ticker

document.getElementById("header").textContent = HEADER;

// ---- Team color map (primary brand color) ----
const COLORS = {
  "Diamondbacks":"#A71930","Arizona Diamondbacks":"#A71930",
  "Braves":"#13274F","Atlanta Braves":"#13274F",
  "Orioles":"#DF4601","Baltimore Orioles":"#DF4601",
  "Red Sox":"#BD3039","Boston Red Sox":"#BD3039",
  "Cubs":"#0E3386","Chicago Cubs":"#0E3386",
  "White Sox":"#27251F","Chicago White Sox":"#27251F",
  "Reds":"#C6011F","Cincinnati Reds":"#C6011F",
  "Guardians":"#0C2340","Cleveland Guardians":"#0C2340",
  "Rockies":"#33006F","Colorado Rockies":"#33006F",
  "Tigers":"#0C2340","Detroit Tigers":"#0C2340",
  "Astros":"#002D62","Houston Astros":"#002D62",
  "Royals":"#004687","Kansas City Royals":"#004687",
  "Angels":"#BA0021","Los Angeles Angels":"#BA0021",
  "Dodgers":"#005A9C","Los Angeles Dodgers":"#005A9C",
  "Marlins":"#00A3E0","Miami Marlins":"#00A3E0",
  "Brewers":"#12284B","Milwaukee Brewers":"#12284B",
  "Twins":"#002B5C","Minnesota Twins":"#002B5C",
  "Mets":"#002D72","New York Mets":"#002D72",
  "Yankees":"#0C2340","New York Yankees":"#0C2340",
  "Athletics":"#003831","Oakland Athletics":"#003831",
  "Phillies":"#E81828","Philadelphia Phillies":"#E81828",
  "Pirates":"#000000","Pittsburgh Pirates":"#000000",
  "Padres":"#2F241D","San Diego Padres":"#2F241D",
  "Giants":"#FD5A1E","San Francisco Giants":"#FD5A1E",
  "Mariners":"#0C2C56","Seattle Mariners":"#0C2C56",
  "Cardinals":"#C41E3A","St. Louis Cardinals":"#C41E3A",
  "Rays":"#092C5C","Tampa Bay Rays":"#092C5C",
  "Rangers":"#003278","Texas Rangers":"#003278",
  "Blue Jays":"#134A8E","Toronto Blue Jays":"#134A8E",
  "Nationals":"#AB0003","Washington Nationals":"#AB0003"
};
const DEFAULT_COLOR = "#6bcfc9"; // fallback mint

// ---------- Helpers ----------
const stripQuotes = (s) => (s||"").trim().replace(/^"|"$/g,"");

function initials(name){
  if (!name) return "";
  const words = name.replace(/\s+/g," ").trim().split(" ");
  const up = (s)=>s.replace(/[^A-Za-z]/g,"").toUpperCase();
  if (words.length === 1) return up(words[0]).slice(0,3);
  return up(words[0][0] + (words[1][0]||"") + (words[2]?.[0]||""));
}

function colorFor(team){
  if (!team) return DEFAULT_COLOR;
  // exact or nickname
  if (COLORS[team]) return COLORS[team];
  // try to match last word (e.g., "New York Yankees" -> "Yankees")
  const last = team.split(" ").pop();
  return COLORS[last] || DEFAULT_COLOR;
}

function parseCSV(text){
  const lines = text.trim().split(/\r?\n/);
  if (lines.length < 2) return [];
  const header = lines[0].split(',').map(stripQuotes);
  if (header[0] !== "Team" || header[1] !== "Status" || header[2] !== "LogoURL") return [];
  const rows = [];
  for (let i=1;i<lines.length;i++){
    const line = lines[i];
    if (!line.trim()) continue;
    const parts = line.split(',');
    const team = stripQuotes(parts[0]);
    const stat = stripQuotes(parts[1]);
    // LogoURL ignored for rendering colors, but we still parse it
    const logo = stripQuotes(parts.slice(2).join(','));
    if (team) rows.push({ Team: team, Status: stat, LogoURL: logo });
  }
  return rows;
}

function render(rows){
  const grid = document.getElementById("grid");
  const ticker = document.getElementById("ticker");
  grid.innerHTML = ""; ticker.innerHTML = "";

  const items = rows.map(r => ({
    team: r.Team,
    status: String(r.Status||"").toUpperCase()
  }));

  const avail = items.filter(x => x.status !== "SOLD");
  const sold  = items.filter(x => x.status === "SOLD");

  document.getElementById("countTotal").textContent = items.length;
  document.getElementById("countAvail").textContent = avail.length;
  document.getElementById("countSold").textContent  = sold.length;

  (avail.length ? avail : items).forEach(it => {
    const card = document.createElement("div");
    card.className = "card " + (it.status==="SOLD" ? "sold" : "available");

    const sw = document.createElement("div");
    sw.className = "swatch";
    sw.style.background = colorFor(it.team);
    sw.textContent = initials(it.team);

    const nm  = document.createElement("div");
    nm.className = "name";
    nm.textContent = it.team;

    card.appendChild(sw);
    card.appendChild(nm);
    grid.appendChild(card);
  });

  const doubled = [...items, ...items];
  doubled.forEach(it => {
    const el = document.createElement("div");
    el.className = "ti " + (it.status==="SOLD" ? "sold" : "available");
    const sw = document.createElement("div");
    sw.className = "swatch"; sw.style.width="22px"; sw.style.height="22px"; sw.style.fontSize="10px";
    sw.style.background = colorFor(it.team);
    sw.textContent = initials(it.team);
    const name = document.createElement("span"); name.textContent = it.team;
    const tag  = document.createElement("span");
    tag.className = "tag " + (it.status==="SOLD" ? "sd" : "av");
    tag.textContent = (it.status==="SOLD" ? "SOLD" : "AVAILABLE");
    el.appendChild(sw); el.appendChild(name); el.appendChild(tag);
    ticker.appendChild(el);
  });

  // Ticker animation (CSS keyframes injected once)
  requestAnimationFrame(() => {
    const totalW = Array.from(ticker.children).reduce((w,el)=> w + el.getBoundingClientRect().width + 20, 0);
    const half = totalW / 2;
    const dur  = Math.max(6, half / (SPEED || 22));
    ticker.style.width = totalW + "px";
    let st = document.getElementById("ab_scroll_style");
    if (!st){ st = document.createElement("style"); st.id = "ab_scroll_style"; document.head.appendChild(st); }
    st.textContent = "@keyframes ab_scroll{from{transform:translateX(0)}to{transform:translateX(-50%)}}";
    ticker.style.animation = `ab_scroll ${dur}s linear infinite`;
  });
}

// URL of your Apps Script endpoint
const DATA_URL = "https://script.google.com/macros/s/AKfycbx_MQxoGuxw2WlOMZlBO4-_ou2wFyqbooZapEjedHLP-bfHvNqsy1oUA234Hd9Uoqg9/exec";
  
async function loadAndRender(){
  try{
    const res = await fetch(DATA_URL + "?cb=" + Date.now(), { cache: "no-store" });
    const rows = await res.json(); // Expect [{Team, Status, LogoURL?}]
    render(rows.map(r => ({
      Team: r.Team,
      Status: r.Status,
      LogoURL: r.LogoURL || ""
    })));
  }catch(e){ console.error(e); }
}


loadAndRender();
setInterval(loadAndRender, Math.max(5, REFRESH) * 1000);
</script>
</body>
</html>
