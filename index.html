<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>The Atomic Break Board</title>
<link href="https://fonts.googleapis.com/css2?family=Monoton&family=Signika:wght@500;700&display=swap" rel="stylesheet">
<style>
  :root{ --bg:#0b1320; --panel:#0f2138; --mint:#9ff5d1; --neon:#f5e87a; --avail:#34f29a; --sold:#8aa0b2; }
  html,body{margin:0;height:100%;background:transparent;overflow:hidden;font-family:"Signika",system-ui,sans-serif;}
  .wrap{position:absolute;inset:0;display:flex;flex-direction:column;gap:8px;padding:12px 14px 10px;
        background:radial-gradient(1200px 600px at 12% 0%, #163355 0%, var(--bg) 60%);
        border:2px solid rgba(0,255,229,.18);border-radius:16px;box-shadow:0 12px 28px rgba(0,0,0,.45), inset 0 0 22px rgba(0,255,229,.08);}
  .toprow{display:flex;justify-content:space-between;align-items:center}
  .header{font-family:"Monoton",cursive;font-size:32px;letter-spacing:2px;color:var(--neon);
          text-shadow:0 0 6px rgba(245,232,122,.9),0 0 18px rgba(245,232,122,.55);}
  .status{font-size:12px;color:#cfe7ff;opacity:.85}
  .status .err{color:#ff7b7b}
  .counts{display:flex;gap:12px;justify-content:center;align-items:center;color:#cfe7ff;font-size:14px;}
  .badge{padding:6px 10px;border-radius:999px;border:1px solid rgba(159,245,209,.3);background:rgba(159,245,209,.08);}
  .badge .v{font-weight:700;color:var(--mint);margin-left:6px}
  .badge .g{color:var(--avail);margin-left:6px}
  .badge .r{color:#ff6b6b;margin-left:6px}
  .panel{position:relative;margin-top:4px;width:100%;flex:1 1 auto;background:linear-gradient(180deg,#0d1e33,var(--panel));
         border:2px solid rgba(159,245,209,.25);border-radius:16px;box-shadow:0 10px 26px rgba(0,0,0,.45), inset 0 0 18px rgba(159,245,209,.08);
         display:flex;flex-direction:column;overflow:hidden;}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(230px,1fr));gap:10px;padding:10px;overflow:auto;}
  .card{display:flex;align-items:center;gap:12px;padding:10px 14px;border-radius:14px;background:rgba(159,245,209,.07);
        border:1px solid rgba(159,245,209,.28);box-shadow:0 3px 12px rgba(0,0,0,.28), inset 0 0 12px rgba(159,245,209,.08);color:#cfe7ff;}
  .swatch{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;
          color:white;font-weight:800;letter-spacing:.5px;text-shadow:0 1px 2px rgba(0,0,0,.45);box-shadow:0 0 8px rgba(0,0,0,.35);}
  .name{font-weight:700;letter-spacing:.4px;color:var(--mint);}
  .card.sold{opacity:.6;filter:saturate(.25) grayscale(.3);border-color:rgba(138,160,178,.35);}
  .card.available .name{color:var(--avail);text-shadow:0 0 10px rgba(52,242,154,.4);}
  .card.sold .name{color:var(--sold);text-decoration:line-through;}
  .ticker-wrap{margin-top:auto;width:100%;border-top:1px solid rgba(0,255,229,.14);background:rgba(3,12,24,.35);}
  .ticker-mask{overflow:hidden;width:100%;}
  .ticker-track{display:flex;align-items:center;gap:20px;padding:8px 16px;white-space:nowrap;will-change:transform;}
  .ti{display:inline-flex;align-items:center;gap:10px;padding:6px 12px;border:1px solid rgba(159,245,209,.25);
      border-radius:999px;background:rgba(159,245,209,.08)}
  .ti.sold{opacity:.55;filter:saturate(.2)}
  .ti .tag{font-size:12px;padding:2px 8px;border-radius:999px;border:1px solid;}
  .ti .tag.av{color:var(--avail);border-color:rgba(52,242,154,.35);background:rgba(52,242,154,.15)}
  .ti .tag.sd{color:#ff6b6b;border-color:rgba(255,107,107,.35);background:rgba(255,107,107,.12)}
</style>
</head>
<body>
  <div class="wrap">
    <div class="toprow">
      <div class="header" id="header">The Atomic Break Board</div>
      <div class="status" id="status">Starting…</div>
    </div>
    <div class="counts">
      <div class="badge">Teams <span class="v" id="countTotal">0</span></div>
      <div class="badge">Available <span class="g" id="countAvail">0</span></div>
      <div class="badge">Sold <span class="r" id="countSold">0</span></div>
    </div>
    <div class="panel">
      <div class="grid" id="grid"></div>
      <div class="ticker-wrap">
        <div class="ticker-mask">
          <div class="ticker-track" id="ticker"></div>
        </div>
      </div>
    </div>
  </div>

<script>
// ===== CONFIG =====
const DATA_URL = "https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLjLQj2UZDXCj170h_znxqY7ibj4v38Juu6PxVrmwM4dsK1DXDwpR_VcDp_tMFQKny-Ynp4ypX4HwV7KWGjA4O5R4xr1bOEIS-HOS-2S4SP7Loh86Zaru_G0XaaVQZf6VgYYzEQL9uZIV1y83mhuupnZ5DhdE_ioyU3b5pCXpRZ5eGKecmfNSRWGx2cxijT1Oh64PpDahUHUcsUu5pPGtAl1CrnW4C5Uc8ILp2wvNludjdug3pXHjyWmQ-g5QJvYkeLaXGWc7D7hcYUZjK52SgE38oAIWw&lib=MsQZwM3WqQlPHIciM4oNKau_oLD-blKr1";
const HEADER  = "The Atomic Break Board";
const REFRESH = 3;   // seconds
const SPEED   = 22;  // px/sec ticker speed

document.getElementById("header").textContent = HEADER;

// ---- Team colors ----
const COLORS = {
  "Yankees":"#0C2340","Mariners":"#0C2C56","Dodgers":"#005A9C","Angels":"#BA0021","Mets":"#002D72",
  "Astros":"#002D62","Red Sox":"#BD3039","Braves":"#13274F","Rays":"#092C5C","Padres":"#2F241D",
  "Giants":"#FD5A1E","Cardinals":"#C41E3A","Rangers":"#003278","Cubs":"#0E3386","Pirates":"#000000",
  "Nationals":"#AB0003","Athletics":"#003831","Diamondbacks":"#A71930","Orioles":"#DF4601",
  "Twins":"#002B5C","Phillies":"#E81828","Tigers":"#0C2340","Blue Jays":"#134A8E","Rockies":"#33006F",
  "Royals":"#004687","Brewers":"#12284B","White Sox":"#27251F","Marlins":"#00A3E0","Guardians":"#0C2340"
};
const DEFAULT_COLOR = "#6bcfc9";

// Helpers
const $ = sel => document.querySelector(sel);
const strip = s => (s||"").trim();
const initials = n => n.split(/\s+/).map(x=>x[0]||"").join("").slice(0,3).toUpperCase();
const colorFor = t => COLORS[t] || COLORS[t.split(" ").pop()] || DEFAULT_COLOR;

function setStatus(msg, isErr=false){
  const el = $("#status");
  el.innerHTML = isErr ? `<span class="err">${msg}</span>` : msg;
}

function render(rows){
  const grid = $("#grid");
  const ticker = $("#ticker");
  grid.innerHTML = ""; ticker.innerHTML = "";

  const items = rows.map(r => ({team:r.Team, status:String(r.Status||"").toUpperCase()}));
  const avail = items.filter(x=>x.status!=="SOLD");
  const sold = items.filter(x=>x.status==="SOLD");

  $("#countTotal").textContent = items.length;
  $("#countAvail").textContent = avail.length;
  $("#countSold").textContent  = sold.length;

  (avail.length?avail:items).forEach(it=>{
    const card=document.createElement("div");
    card.className="card "+(it.status==="SOLD"?"sold":"available");
    const sw=document.createElement("div");
    sw.className="swatch";
    sw.style.background=colorFor(it.team);
    sw.textContent=initials(it.team);
    const nm=document.createElement("div");
    nm.className="name";
    nm.textContent=it.team;
    card.append(sw,nm);
    grid.append(card);
  });

  const doubled=[...items,...items];
  doubled.forEach(it=>{
    const el=document.createElement("div");
    el.className="ti "+(it.status==="SOLD"?"sold":"available");
    const sw=document.createElement("div");
    sw.className="swatch";
    sw.style.width="22px";sw.style.height="22px";sw.style.fontSize="10px";
    sw.style.background=colorFor(it.team);
    sw.textContent=initials(it.team);
    const nm=document.createElement("span");
    nm.textContent=it.team;
    const tag=document.createElement("span");
    tag.className="tag "+(it.status==="SOLD"?"sd":"av");
    tag.textContent=it.status==="SOLD"?"SOLD":"AVAILABLE";
    el.append(sw,nm,tag);
    ticker.append(el);
  });

  requestAnimationFrame(()=>{
    const totalW=Array.from(ticker.children).reduce((w,e)=>w+e.getBoundingClientRect().width+20,0);
    const dur=Math.max(6,totalW/(SPEED||22)/2);
    ticker.style.width=totalW+"px";
    let st=document.getElementById("ab_scroll_style");
    if(!st){st=document.createElement("style");st.id="ab_scroll_style";document.head.appendChild(st);}
    st.textContent="@keyframes ab_scroll{from{transform:translateX(0)}to{transform:translateX(-50%)}}";
    ticker.style.animation=`ab_scroll ${dur}s linear infinite`;
  });
}

function normalizeRows(raw){
  if (!Array.isArray(raw)) return [];
  return raw.map(r=>({
    Team: strip(r.Team||r.team||""),
    Status: strip(r.Status||r.status||""),
  })).filter(r=>r.Team);
}

async function loadAndRender(){
  try{
    setStatus("Fetching…");
    const res = await fetch(DATA_URL+"?cb="+Date.now(), {cache:"no-store"});
    const txt = await res.text();
    let json;
    try {
      json = JSON.parse(txt);
    } catch {
      setStatus("Endpoint returned non-JSON. Showing last good data. Press D for demo.", true);
      return;
    }
    const rows = normalizeRows(json);
    if (!rows.length){
      setStatus("No rows received. Waiting for Zap/POST… Press D for demo.", true);
      return;
    }
    render(rows);
    setStatus("Connected • "+new Date().toLocaleTimeString());
  }catch(e){
    setStatus("Fetch error: "+(e.message||e), true);
  }
}

loadAndRender();
setInterval(loadAndRender, REFRESH*1000);

// DEMO mode (press D to load sample rows on screen)
document.addEventListener("keydown", (e)=>{
  if (e.key.toLowerCase()==="d"){
    const demo = [
      {Team:"Yankees", Status:"SOLD"},
      {Team:"Mariners", Status:"AVAILABLE"},
      {Team:"Dodgers", Status:"AVAILABLE"},
      {Team:"Cardinals", Status:"SOLD"},
      {Team:"Rangers", Status:"AVAILABLE"}
    ];
    render(demo);
    setStatus("Demo data (press D again anytime) • "+new Date().toLocaleTimeString());
  }
});
</script>
</body>
</html>
