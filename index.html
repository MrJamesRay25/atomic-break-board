<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>The Atomic Break Board</title>
<link href="https://fonts.googleapis.com/css2?family=Monoton&family=Signika:wght@500;700&display=swap" rel="stylesheet">
<style>
  :root{ --bg:#0b1320; --panel:#0f2138; --mint:#9ff5d1; --neon:#f5e87a; --avail:#34f29a; --sold:#8aa0b2; --edge:#00ffe5; }
  html,body{margin:0;height:100%;background:transparent;overflow:hidden;font-family:"Signika",system-ui,sans-serif;}
  .wrap{position:absolute;inset:0;display:flex;flex-direction:column;gap:10px;padding:16px 18px 12px;
        background:radial-gradient(1200px 600px at 12% 0%, #163355 0%, var(--bg) 60%);
        border:2px solid rgba(0,255,229,.18);border-radius:16px;box-shadow:0 12px 28px rgba(0,0,0,.45), inset 0 0 22px rgba(0,255,229,.08);}
  .header{font-family:"Monoton",cursive;font-size:40px;letter-spacing:2px;color:var(--neon);text-align:center;
          text-shadow:0 0 6px rgba(245,232,122,.9),0 0 18px rgba(245,232,122,.55),0 0 36px rgba(245,232,122,.35);}
  .counts{display:flex;gap:14px;justify-content:center;align-items:center;color:#cfe7ff;font-size:14px;}
  .badge{padding:6px 10px;border-radius:999px;border:1px solid rgba(159,245,209,.3);background:rgba(159,245,209,.08);}
  .badge .v{font-weight:700;color:var(--mint);margin-left:6px}
  .badge .g{color:var(--avail);margin-left:6px}
  .badge .r{color:#ff6b6b;margin-left:6px}
  .panel{position:relative;margin-top:6px;width:100%;flex:1 1 auto;background:linear-gradient(180deg,#0d1e33,var(--panel));
         border:2px solid rgba(159,245,209,.25);border-radius:16px;box-shadow:0 10px 26px rgba(0,0,0,.45), inset 0 0 18px rgba(159,245,209,.08);
         display:flex;flex-direction:column;overflow:hidden;}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(230px,1fr));gap:12px;padding:10px;overflow:auto;}
  .card{display:flex;align-items:center;gap:10px;padding:10px 14px;border-radius:14px;background:rgba(159,245,209,.07);
        border:1px solid rgba(159,245,209,.28);box-shadow:0 3px 12px rgba(0,0,0,.28), inset 0 0 12px rgba(159,245,209,.08);color:#cfe7ff;}
  .logo{width:32px;height:32px;border-radius:50%;background:#fff;display:flex;align-items:center;justify-content:center;overflow:hidden;box-shadow:0 0 6px rgba(255,255,255,.25);}
  .logo img{width:100%;height:100%;object-fit:contain;}
  .name{font-weight:700;letter-spacing:.4px;color:var(--mint);}
  .card.sold{opacity:.6;filter:saturate(.25) grayscale(.3);border-color:rgba(138,160,178,.35);}
  .card.available .name{color:var(--avail);text-shadow:0 0 10px rgba(52,242,154,.4);}
  .card.sold .name{color:var(--sold);text-decoration:line-through;}
  .ticker-wrap{margin-top:auto;width:100%;border-top:1px solid rgba(0,255,229,.14);background:rgba(3,12,24,.35);}
  .ticker-mask{overflow:hidden;width:100%;}
  .ticker-track{display:flex;align-items:center;gap:20px;padding:8px 16px;white-space:nowrap;will-change:transform;}
  .ti{display:inline-flex;align-items:center;gap:8px;padding:6px 12px;border:1px solid rgba(159,245,209,.25);border-radius:999px;background:rgba(159,245,209,.08)}
  .ti.sold{opacity:.55;filter:saturate(.2)}
  .ti .tag{font-size:12px;padding:2px 8px;border-radius:999px;border:1px solid;}
  .ti .tag.av{color:var(--avail);border-color:rgba(52,242,154,.35);background:rgba(52,242,154,.15)}
  .ti .tag.sd{color:#ff6b6b;border-color:rgba(255,107,107,.35);background:rgba(255,107,107,.12)}
</style>
</head>
<body>
  <div class="wrap">
    <div class="header" id="header">The Atomic Break Board</div>
    <div class="counts">
      <div class="badge">Teams <span class="v" id="countTotal">0</span></div>
      <div class="badge">Available <span class="g" id="countAvail">0</span></div>
      <div class="badge">Sold <span class="r" id="countSold">0</span></div>
    </div>
    <div class="panel">
      <div class="grid" id="grid"></div>
      <div class="ticker-wrap">
        <div class="ticker-mask">
          <div class="ticker-track" id="ticker"></div>
        </div>
      </div>
    </div>
  </div>

<script>
// ===== EDIT THIS (put your published CSV link) =====
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT2v6-URv5jiKt-jUeqhddeSqYAKE1Gr2405YGaZRvxeWFsRWMu2fAlN9j9mMz24Gp70dchwCnj7xec/pubhtml?gid=0&single=true";

// ===== Settings =====
const HEADER  = "The Atomic Break Board";
const REFRESH = 8;   // seconds
const SPEED   = 22;  // px/sec for ticker
const FALLBACK_LOGO = "https://upload.wikimedia.org/wikipedia/commons/1/1b/Baseball.svg";

// Turn on if GitHub Pages â†’ Google CSV gives CORS errors:
const USE_CORS_PROXY = false; // set to true only if needed

document.getElementById("header").textContent = HEADER;

// ---------- Helpers ----------
const stripQuotes = (s) => (s||"").trim().replace(/^"|"$/g,"");

// Proxy any image URL to bypass hotlink/CORS (works with mlbstatic)
function proxImg(url){
  if (!url) return FALLBACK_LOGO;
  try {
    const u = new URL(url);
    const hostpath = u.host + u.pathname + (u.search || "");
    return "https://images.weserv.nl/?url=" + encodeURIComponent(hostpath) + "&n=-1";
  } catch { return FALLBACK_LOGO; }
}

function mkImg(url){
  const img = document.createElement("img");
  img.referrerPolicy = "no-referrer";
  img.crossOrigin = "anonymous";
  img.src = proxImg(url);
  img.onerror = () => { img.src = FALLBACK_LOGO; };
  return img;
}

function parseCSV(text){
  const lines = text.trim().split(/\r?\n/);
  if (lines.length < 2) return [];
  const header = lines[0].split(',').map(stripQuotes);
  if (header[0] !== "Team" || header[1] !== "Status" || header[2] !== "LogoURL") return [];
  const rows = [];
  for (let i=1;i<lines.length;i++){
    const line = lines[i];
    if (!line.trim()) continue;
    const parts = line.split(',');
    const team = stripQuotes(parts[0]);
    const stat = stripQuotes(parts[1]);
    const logo = stripQuotes(parts.slice(2).join(',')); // keep commas in URL
    if (team) rows.push({ Team: team, Status: stat, LogoURL: logo });
  }
  return rows;
}

function render(rows){
  const grid = document.getElementById("grid");
  const ticker = document.getElementById("ticker");
  grid.innerHTML = ""; ticker.innerHTML = "";

  const items = rows.map(r => ({
    team: r.Team,
    status: String(r.Status||"").toUpperCase(),
    logo: (r.LogoURL||"").trim()
  }));

  const avail = items.filter(x => x.status !== "SOLD");
  const sold  = items.filter(x => x.status === "SOLD");

  document.getElementById("countTotal").textContent = items.length;
  document.getElementById("countAvail").textContent = avail.length;
  document.getElementById("countSold").textContent  = sold.length;

  (avail.length ? avail : items).forEach(it => {
    const card = document.createElement("div");
    card.className = "card " + (it.status==="SOLD" ? "sold" : "available");
    const logo = document.createElement("div"); logo.className = "logo";
    const img = mkImg(it.logo);
    const nm  = document.createElement("div"); nm.className = "name"; nm.textContent = it.team;
    logo.appendChild(img); card.appendChild(logo); card.appendChild(nm);
    grid.appendChild(card);
  });

  const doubled = [...items, ...items];
  doubled.forEach(it => {
    const el = document.createElement("div");
    el.className = "ti " + (it.status==="SOLD" ? "sold" : "available");
    const img = mkImg(it.logo); img.width=22; img.height=22;
    const name = document.createElement("span"); name.textContent = it.team;
    const tag  = document.createElement("span");
    tag.className = "tag " + (it.status==="SOLD" ? "sd" : "av");
    tag.textContent = (it.status==="SOLD" ? "SOLD" : "AVAILABLE");
    el.appendChild(img); el.appendChild(name); el.appendChild(tag);
    ticker.appendChild(el);
  });

  // Ticker animation
  requestAnimationFrame(() => {
    const totalW = Array.from(ticker.children).reduce((w,el)=> w + el.getBoundingClientRect().width + 20, 0);
    const half = totalW / 2;
    const dur  = Math.max(6, half / (SPEED || 22));
    ticker.style.width = totalW + "px";
    let st = document.getElementById("ab_scroll_style");
    if (!st){ st = document.createElement("style"); st.id = "ab_scroll_style"; document.head.appendChild(st); }
    st.textContent = "@keyframes ab_scroll{from{transform:translateX(0)}to{transform:translateX(-50%)}}";
    ticker.style.animation = `ab_scroll ${dur}s linear infinite`;
  });
}

async function loadAndRender(){
  try{
    // Cache-bust the CSV to avoid stale data from Google
    const base = CSV_URL + (CSV_URL.includes("?") ? "&" : "?") + "cb=" + Date.now();
    const url  = USE_CORS_PROXY ? ("https://corsproxy.io/?" + encodeURIComponent(base)) : base;
    const res  = await fetch(url, { cache: "no-store" });
    const txt  = await res.text();
    const rows = parseCSV(txt);
    render(rows);
  }catch(e){
    console.error(e);
  }
}

loadAndRender();
setInterval(loadAndRender, Math.max(5, REFRESH) * 1000);
</script>
</body>
</html>
